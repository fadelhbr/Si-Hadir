<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Load Info</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .server-info {
            margin: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100%;
        }
        .server-info h2 {
            margin-top: 0;
        }
        canvas {
            max-width: 100%;
        }
        .chart-container {
            display: flex;
            justify-content: space-around;
        }
    </style>
</head>
<body>

<h1>Server Load Information</h1>
<div class="server-info">
    <h2>Server Load (1, 5, 15 mins)</h2>
    <p id="load"></p>

    <h2>Memory Usage (GB)</h2>
    <p id="memory"></p>

    <h2>CPU Usage</h2>
    <p id="cpu"></p>

    <div class="chart-container">
        <div style="width: 45%;">
            <h2>System Load (1, 5, 15 mins)</h2>
            <canvas id="loadChart"></canvas>
        </div>
        <div style="width: 45%;">
            <h2>CPU Load</h2>
            <canvas id="cpuChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    let loadChartCtx = document.getElementById('loadChart').getContext('2d');
    let cpuChartCtx = document.getElementById('cpuChart').getContext('2d');

    // Initialize the charts with empty data
    let loadChart = new Chart(loadChartCtx, {
        type: 'line',
        data: {
            labels: [], // Time stamps will be added here
            datasets: [{
                label: 'System Load (1, 5, 15 mins)',
                data: [],
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1,
                fill: false
            }]
        },
        options: {
            scales: {
                x: { 
                    type: 'linear',
                    position: 'bottom',
                    ticks: { beginAtZero: true }
                },
                y: { 
                    beginAtZero: true,
                    max: 100  // Max is 100% for load
                }
            }
        }
    });

    let cpuChart = new Chart(cpuChartCtx, {
        type: 'line',
        data: {
            labels: [], // Time stamps will be added here
            datasets: [{
                label: 'CPU Usage',
                data: [],
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1,
                fill: false
            }]
        },
        options: {
            scales: {
                x: { 
                    type: 'linear',
                    position: 'bottom',
                    ticks: { beginAtZero: true }
                },
                y: { 
                    beginAtZero: true,
                    max: 100  // Max is 100% for CPU usage
                }
            }
        }
    });

    // Function to update the server stats and charts
    function updateServerInfo() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'server_load.php', true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
            try {
                var data = JSON.parse(xhr.responseText);
                console.log('Data received:', data); // Debugging line

                // Update the server load (1, 5, 15 mins)
                document.getElementById('load').textContent = `Load: ${data.load[0]}% (1 min), ${data.load[1]}% (5 min), ${data.load[2]}% (15 min)`;

                // Update memory usage in GB
                document.getElementById('memory').textContent = `${data.memory} GB`;

                // Update CPU usage
                document.getElementById('cpu').textContent = `${data.cpu}%`;

                // Update the charts with the latest data
                var time = new Date().toLocaleTimeString();
                
                // Update Load Chart (1, 5, 15 mins)
                loadChart.data.labels.push(time);
                loadChart.data.datasets[0].data.push(data.load[0]);  // Add 1-minute load
                if (loadChart.data.labels.length > 10) { // Keep last 10 entries
                    loadChart.data.labels.shift();
                    loadChart.data.datasets[0].data.shift();
                }
                loadChart.update();

                // Update CPU Chart
                cpuChart.data.labels.push(time);
                cpuChart.data.datasets[0].data.push(data.cpu);  // Add CPU usage
                if (cpuChart.data.labels.length > 10) { // Keep last 10 entries
                    cpuChart.data.labels.shift();
                    cpuChart.data.datasets[0].data.shift();
                }
                cpuChart.update();

            } catch (error) {
                console.error('Error parsing server data:', error); // Debugging error
            }
        }
    };
    xhr.send();
}


    // Update server info every 5 seconds
    setInterval(updateServerInfo, 5000);

    // Fetch the initial data when the page loads
    window.onload = updateServerInfo;
</script>

</body>
</html>
